{% extends "admin/base.html" %}

{% block title %}è·å¥–è®°å½•å’Œé¡¹ç›®æ¦‚è§ˆç®¡ç† - ç®¡ç†åå°{% endblock %}

{% block extra_head %}
<!-- ä½¿ç”¨æ›´ç¨³å®šçš„Sortable.js CDNé“¾æ¥ -->
<script>
// API URLè¾…åŠ©å‡½æ•° - å…¼å®¹Verceléƒ¨ç½²
function getApiUrl(path) {
    // åœ¨Vercelç¯å¢ƒä¸‹ä½¿ç”¨å½“å‰åŸŸåï¼Œæœ¬åœ°å¼€å‘ä½¿ç”¨ç›¸å¯¹è·¯å¾„
    if (window.location.hostname.includes('vercel.app') || window.location.hostname.includes('vercel.com')) {
        return window.location.origin + path;
    }
    return path;
}
</script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<style>
/* æ•´ä½“é¡µé¢ç¾åŒ– */
body {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    color: #ffffff;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.main-content {
    background: rgba(255, 255, 255, 0.05);
}

/* æ¶ˆæ¯æç¤ºç³»ç»Ÿ */
.message-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 10000;
    max-width: 400px;
}

.message {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 12px;
    padding: 16px 20px;
    margin-bottom: 10px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    border-left: 4px solid;
    display: flex;
    align-items: center;
    gap: 12px;
    transform: translateX(450px);
    transition: transform 0.3s ease;
}

.message.show {
    transform: translateX(0);
}

.message.success { border-left-color: #22c55e; color: #166534; }
.message.error { border-left-color: #ef4444; color: #dc2626; }
.message.info { border-left-color: #3b82f6; color: #1d4ed8; }

.message-icon {
    font-size: 18px;
    font-weight: bold;
}

/* å¡ç‰‡ç¾åŒ– - è°ƒæ•´èƒŒæ™¯è‰²æé«˜å¯¹æ¯”åº¦ */
.card {
    background: linear-gradient(145deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.08));
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.25);
    border-radius: 20px;
    padding: 24px;
    margin-bottom: 24px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
}

/* è¡¨æ ¼ç¾åŒ– - è°ƒæ•´èƒŒæ™¯è‰²æé«˜å¯¹æ¯”åº¦ */
.table {
    width: 100%;
    border-collapse: collapse;
    background: rgba(255, 255, 255, 0.08);
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    border: 2px solid rgba(102, 126, 234, 0.3);
}

.table th {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 16px;
    font-weight: 700;
    text-align: left;
    border: none;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-size: 0.9rem;
    position: relative;
}

.table th:not(:last-child)::after {
    content: '';
    position: absolute;
    right: 0;
    top: 20%;
    height: 60%;
    width: 1px;
    background: rgba(255, 255, 255, 0.3);
}

.table td {
    padding: 16px;
    border-bottom: 2px solid rgba(102, 126, 234, 0.15);
    transition: all 0.3s ease;
    background: rgba(15, 15, 35, 0.8);
    vertical-align: middle;
    position: relative;
}

.table tbody tr:nth-child(even) td {
    background: rgba(25, 25, 45, 0.9);
}

.table tbody tr:nth-child(odd) td {
    background: rgba(20, 20, 40, 0.9);
}

.table tbody tr:hover td {
    background: linear-gradient(90deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3));
    transform: scale(1.005);
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
}

.table tbody tr:last-child td {
    border-bottom: none;
}

/* è¡¨æ ¼åˆ—åˆ†éš”çº¿ */
.table td:not(:last-child)::after {
    content: '';
    position: absolute;
    right: 0;
    top: 15%;
    height: 70%;
    width: 1px;
    background: rgba(102, 126, 234, 0.2);
}

/* æ‹–æ‹½æ‰‹æŸ„ç¾åŒ– - æé«˜å¯è§æ€§ */
.sort-handle {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    border-radius: 8px;
    cursor: grab;
    position: relative;
    transition: all 0.3s ease;
    margin: 0 auto;
    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
    border: 2px solid rgba(255, 255, 255, 0.2);
}

.sort-handle:before {
    content: 'â‹®â‹®';
    color: white;
    font-size: 14px;
    font-weight: bold;
    line-height: 1;
}

.sort-handle:hover {
    transform: scale(1.15) rotate(5deg);
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.6);
    border-color: rgba(255, 255, 255, 0.4);
}

.sort-handle:active {
    cursor: grabbing;
    transform: scale(0.95);
}

/* è¡¨æ ¼å†…å®¹æ ·å¼å¢å¼º */
.table td strong {
    color: #ffffff;
    font-weight: 600;
    font-size: 1rem;
}

.table td .badge {
    padding: 8px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.table td code {
    background: rgba(102, 126, 234, 0.25);
    padding: 6px 10px;
    border-radius: 6px;
    color: #667eea;
    font-weight: 600;
    font-size: 0.9rem;
    border: 1px solid rgba(102, 126, 234, 0.3);
    display: inline-block;
    min-width: 60px;
    text-align: center;
}

/* çŠ¶æ€å¾½ç« æ ·å¼ä¼˜åŒ– */
.badge.bg-success {
    background: linear-gradient(135deg, #22c55e, #16a34a) !important;
    color: white !important;
    box-shadow: 0 2px 8px rgba(34, 197, 94, 0.3);
}

.badge.bg-secondary {
    background: linear-gradient(135deg, #6b7280, #4b5563) !important;
    color: white !important;
    box-shadow: 0 2px 8px rgba(107, 114, 128, 0.3);
}

.badge.bg-primary {
    background: linear-gradient(135deg, #667eea, #764ba2) !important;
    color: white !important;
    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
}

.badge.bg-warning {
    background: linear-gradient(135deg, #f59e0b, #d97706) !important;
    color: white !important;
    box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
}

/* æ“ä½œæŒ‰é’®æ ·å¼ä¼˜åŒ– */
.table td .btn {
    margin: 2px;
    font-size: 0.8rem;
    padding: 6px 12px;
    border-radius: 8px;
    font-weight: 500;
    transition: all 0.3s ease;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.table td .btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.table td .btn-danger {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: rgba(239, 68, 68, 0.3);
}

.table td .btn-danger:hover {
    background: linear-gradient(135deg, #dc2626, #b91c1c);
    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
}

/* è¡¨æ ¼å“åº”å¼ä¼˜åŒ– */
.table-responsive {
    border-radius: 15px;
    overflow: hidden;
    border: 2px solid rgba(102, 126, 234, 0.3);
}

/* è¡¨æ ¼è¡Œç¾åŒ– - æé«˜æ¸…æ™°åº¦ */
.sortable-item {
    transition: all 0.3s ease;
    cursor: move;
    border-left: 3px solid transparent;
}

.sortable-item:hover {
    border-left-color: #667eea;
    background: linear-gradient(90deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2));
}

.sortable-chosen {
    background: linear-gradient(90deg, rgba(102, 126, 234, 0.4), rgba(118, 75, 162, 0.4)) !important;
    transform: rotate(1deg) scale(1.02);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
    border-left-color: #667eea;
}

.sortable-ghost {
    opacity: 0.6;
    transform: scale(0.98);
    background: rgba(102, 126, 234, 0.1) !important;
}

/* è¡¨æ ¼ç©ºçŠ¶æ€ç¾åŒ– */
.empty-state {
    text-align: center;
    padding: 4rem 2rem;
    color: rgba(255, 255, 255, 0.8);
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    margin: 1rem;
}

.empty-state i {
    font-size: 3.5rem;
    margin-bottom: 1.5rem;
    display: block;
    color: rgba(102, 126, 234, 0.6);
    text-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
}

.empty-state p {
    font-size: 1.2rem;
    margin-bottom: 0.8rem;
    color: #ffffff;
    font-weight: 500;
}

.empty-state .sub-text {
    font-size: 1rem;
    margin-top: 0.5rem;
    color: rgba(255, 255, 255, 0.6);
    font-style: italic;
}

/* æŒ‰é’®ç¾åŒ– */
.btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 12px;
    font-weight: 600;
    transition: all 0.3s ease;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    text-decoration: none;
    display: inline-block;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    color: white;
}

.btn:active {
    transform: translateY(0);
}

.btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.btn-success {
    background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
    color: #1f2937;
}

.btn-success:hover {
    color: #1f2937;
    box-shadow: 0 8px 25px rgba(132, 250, 176, 0.4);
}

.btn-danger {
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
}

.btn-danger:hover {
    box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
}

.btn-sm {
    padding: 6px 12px;
    font-size: 14px;
    border-radius: 8px;
}

/* è¡¨å•æ§ä»¶ç¾åŒ– - è°ƒæ•´èƒŒæ™¯è‰²æé«˜å¯¹æ¯”åº¦ */
input, select, textarea {
    background: rgba(255, 255, 255, 0.12);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 12px;
    padding: 12px 16px;
    color: #ffffff;
    font-size: 14px;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    width: 100%;
}

input:focus, select:focus, textarea:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
    background: rgba(255, 255, 255, 0.18);
}

input::placeholder, textarea::placeholder {
    color: rgba(255, 255, 255, 0.7);
}

/* ç¾åŒ–ä¸‹æ‹‰é€‰é¡¹ */
select option {
    background: #2a2a4a;
    color: #ffffff;
    padding: 8px;
}

/* è¡¨å•ç»„æ ·å¼ */
.form-group {
    margin-bottom: 1rem;
}

.form-group .form-label {
    color: rgba(255, 255, 255, 0.95);
    font-weight: 500;
    margin-bottom: 8px;
    display: block;
}

.form-group .form-label span {
    color: #ffffff;
    font-weight: 600;
}

/* è¡¨å•éªŒè¯æ ·å¼ */
.form-control.is-invalid {
    border-color: #ef4444;
    box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
}

.invalid-feedback {
    display: block;
    color: #ef4444;
    font-size: 12px;
    margin-top: 4px;
}

/* ä»£ç ç¼–è¾‘å™¨æ ·å¼ - è°ƒæ•´èƒŒæ™¯è‰²æé«˜å¯¹æ¯”åº¦ */
.code-editor {
    font-family: 'Courier New', 'Monaco', 'Menlo', monospace;
    font-size: 13px;
    line-height: 1.4;
    background: rgba(255, 255, 255, 0.15) !important;
    border: 1px solid rgba(102, 126, 234, 0.5) !important;
}

.code-editor:focus {
    background: rgba(255, 255, 255, 0.2) !important;
    border-color: #667eea !important;
}

/* æŒ‰é’®åŠ è½½çŠ¶æ€ */
.btn-loading {
    display: none;
}

.btn.loading .btn-text {
    display: none;
}

.btn.loading .btn-loading {
    display: inline-block;
}

.btn.loading {
    pointer-events: none;
    opacity: 0.8;
}

/* æ¨¡æ€æ¡†æ ·å¼å·²ç»Ÿä¸€åˆ°base.htmlä¸­ */

.modal label {
    color: rgba(255, 255, 255, 0.95);
    font-weight: 500;
    margin-bottom: 8px;
}

.modal label span {
    color: #ffffff;
    font-weight: 600;
}

/* çŠ¶æ€å¾½ç« ç¾åŒ– */
.badge {
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.badge.bg-success {
    background: linear-gradient(135deg, #22c55e, #16a34a) !important;
    color: white !important;
}

.badge.bg-secondary {
    background: linear-gradient(135deg, #6b7280, #4b5563) !important;
    color: white !important;
}

.badge.bg-primary {
    background: linear-gradient(135deg, #667eea, #764ba2) !important;
    color: white !important;
}

.badge.bg-warning {
    background: linear-gradient(135deg, #f59e0b, #d97706) !important;
    color: white !important;
}

/* é¡µé¢æ ‡é¢˜ç¾åŒ– */
.page-title-box {
    background: linear-gradient(145deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.08));
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.25);
    border-radius: 20px;
    padding: 24px;
    margin-bottom: 24px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.page-title {
    color: #ffffff;
    font-size: 28px;
    font-weight: 700;
    text-align: center;
    background: linear-gradient(135deg, #667eea, #764ba2);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin: 0;
}

.breadcrumb {
    background: rgba(255, 255, 255, 0.05);
    padding: 8px 16px;
    margin: 0 0 16px 0;
    border-radius: 8px;
}

.breadcrumb-item a {
    color: rgba(255, 255, 255, 0.8);
    text-decoration: none;
    transition: color 0.3s ease;
}

.breadcrumb-item a:hover {
    color: #667eea;
}

.breadcrumb-item.active {
    color: #667eea;
}

/* å¡ç‰‡å¤´éƒ¨ç¾åŒ– - è°ƒæ•´èƒŒæ™¯è‰²æé«˜å¯¹æ¯”åº¦ */
.card-header {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.25), rgba(118, 75, 162, 0.25));
    border-bottom: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 15px 15px 0 0;
    padding: 20px 24px;
}

.header-title {
    color: #ffffff;
    font-size: 20px;
    font-weight: 600;
    margin: 0;
    background: linear-gradient(135deg, #667eea, #764ba2);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

/* è¡¨æ ¼å“åº”å¼ */
.table-responsive {
    border-radius: 15px;
    overflow: hidden;
}

/* å“åº”å¼è®¾è®¡æ”¹è¿› */
@media (max-width: 768px) {
    .table-actions {
        flex-direction: column;
        gap: 16px;
    }
    
    .btn-group {
        justify-content: center;
    }
    
    .table th, .table td {
        padding: 8px 12px;
        font-size: 14px;
    }
    
    .modal-dialog {
        margin: 10px;
    }
    
    .card {
        padding: 16px;
    }
    
    .page-title-box {
        padding: 16px;
    }
    
    .page-title {
        font-size: 24px;
    }
}

@media (max-width: 576px) {
    .table-responsive {
        font-size: 12px;
    }
    
    .btn {
        padding: 8px 16px;
        font-size: 14px;
    }
    
    .btn-sm {
        padding: 4px 8px;
        font-size: 12px;
    }
    
    .modal-dialog {
        margin: 5px;
    }
    
    .modal-body {
        padding: 16px;
    }
    
    .modal-footer {
        padding: 12px 16px;
    }
}

/* åŠ¨ç”»å¢å¼º */
.card, .btn, .table tbody tr {
    will-change: transform;
}

/* æ»šåŠ¨æ¡ç¾åŒ– */
::-webkit-scrollbar {
    width: 8px;
}

::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, #667eea, #764ba2);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(135deg, #764ba2, #667eea);
}

/* ç©ºçŠ¶æ€ç¾åŒ– */
.empty-state {
    text-align: center;
    padding: 3rem;
    color: rgba(255, 255, 255, 0.8);
}

.empty-state i {
    font-size: 3rem;
    margin-bottom: 1rem;
    display: block;
    color: rgba(102, 126, 234, 0.6);
}

.empty-state p {
    font-size: 1.1rem;
    margin-bottom: 0.5rem;
}

.empty-state .sub-text {
    font-size: 0.9rem;
    margin-top: 0.5rem;
    color: rgba(255, 255, 255, 0.6);
}

/* æœç´¢å’Œç­›é€‰åŒºåŸŸç¾åŒ– - è°ƒæ•´èƒŒæ™¯è‰²æé«˜å¯¹æ¯”åº¦ */
.table-actions {
    background: rgba(255, 255, 255, 0.08);
    padding: 16px;
    border-radius: 12px;
    margin-bottom: 20px;
    border: 1px solid rgba(255, 255, 255, 0.15);
}

.btn-group {
    display: flex;
    gap: 12px;
    align-items: center;
}

/* è¡¨æ ¼è¡Œç¾åŒ– */
.sortable-item {
    transition: all 0.3s ease;
    cursor: move;
}

.sortable-item:hover {
    background: linear-gradient(90deg, rgba(102, 126, 234, 0.25), rgba(118, 75, 162, 0.25));
    transform: scale(1.01);
}

.sortable-chosen {
    background: linear-gradient(90deg, rgba(102, 126, 234, 0.35), rgba(118, 75, 162, 0.35)) !important;
    transform: rotate(2deg) scale(1.05);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
}

.sortable-ghost {
    opacity: 0.4;
    transform: scale(0.95);
}

/* è¡¨æ ¼åˆ—å®½ä¼˜åŒ– */
.table th:nth-child(1) { width: 80px; }  /* æ’åºåˆ— */
.table th:nth-child(2) { width: auto; }  /* æ ‡é¢˜åˆ— */
.table th:nth-child(3) { width: 120px; } /* åˆ†ç±»/ç«èµ›åç§°åˆ— */
.table th:nth-child(4) { width: 120px; } /* æ—¶é—´å¤æ‚åº¦/è·å¥–ç­‰çº§åˆ— */
.table th:nth-child(5) { width: 120px; } /* ç©ºé—´å¤æ‚åº¦/è·å¥–è€…åˆ— */
.table th:nth-child(6) { width: 100px; } /* æ¯”èµ›æ—¥æœŸåˆ— */
.table th:nth-child(7) { width: 100px; } /* çŠ¶æ€åˆ— */
.table th:nth-child(8) { width: 160px; } /* æ“ä½œåˆ— */

/* è¡¨æ ¼è¡Œäº¤æ›¿èƒŒæ™¯è‰²å¢å¼º */
.table tbody tr:nth-child(even) {
    background: rgba(25, 25, 45, 0.9);
}

.table tbody tr:nth-child(odd) {
    background: rgba(20, 20, 40, 0.9);
}

.table tbody tr:nth-child(even):hover {
    background: linear-gradient(90deg, rgba(102, 126, 234, 0.25), rgba(118, 75, 162, 0.25)) !important;
}

.table tbody tr:nth-child(odd):hover {
    background: linear-gradient(90deg, rgba(102, 126, 234, 0.25), rgba(118, 75, 162, 0.25)) !important;
}

/* è¡¨æ ¼å•å…ƒæ ¼å†…å®¹å¯¹é½ä¼˜åŒ– */
.table td {
    vertical-align: top;
    padding: 16px 12px;
}

/* è¡¨æ ¼æ ‡é¢˜åˆ—ç‰¹æ®Šæ ·å¼ */
.table td:nth-child(2) {
    text-align: left;
    padding-left: 16px;
}

/* è¡¨æ ¼å†…å®¹åˆ—å±…ä¸­å¯¹é½ */
.table td:nth-child(1),
.table td:nth-child(3),
.table td:nth-child(4),
.table td:nth-child(5),
.table td:nth-child(6),
.table td:nth-child(7),
.table td:nth-child(8) {
    text-align: center;
}

/* è¡¨æ ¼è¡Œåˆ†éš”çº¿å¢å¼º */
.table tbody tr:not(:last-child) td {
    border-bottom: 2px solid rgba(102, 126, 234, 0.2);
}

/* è¡¨æ ¼æ‚¬åœæ•ˆæœå¢å¼º */
.table tbody tr:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
    z-index: 1;
    position: relative;
}

/* è¡¨æ ¼å†…å®¹æ–‡æœ¬é˜´å½± */
.table td strong,
.table td div:first-child {
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
}

/* è¡¨æ ¼å¾½ç« æ‚¬åœæ•ˆæœ */
.table td .badge {
    transition: all 0.3s ease;
    cursor: default;
}

.table td .badge:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
}

/* è¡¨æ ¼ä»£ç å—æ‚¬åœæ•ˆæœ */
.table td code {
    transition: all 0.3s ease;
    cursor: default;
}

.table td code:hover {
    transform: scale(1.02);
    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
}

/* è¡¨æ ¼æŒ‰é’®ç»„æ ·å¼ä¼˜åŒ– */
.table td .btn-group {
    display: flex;
    gap: 6px;
    justify-content: center;
    flex-wrap: wrap;
}

/* è¡¨æ ¼ç©ºçŠ¶æ€å¢å¼º */
.empty-state {
    background: linear-gradient(145deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.05));
    border: 1px solid rgba(102, 126, 234, 0.2);
    backdrop-filter: blur(10px);
}

/* å“åº”å¼è¡¨æ ¼ä¼˜åŒ– */
@media (max-width: 768px) {
    .table th, .table td {
        padding: 12px 8px;
        font-size: 0.85rem;
    }
    
    .table td .btn {
        padding: 4px 8px;
        font-size: 0.75rem;
    }
    
    .table td .badge {
        padding: 6px 8px;
        font-size: 0.7rem;
    }
    
    .table td code {
        padding: 6px 8px;
        font-size: 0.8rem;
        min-width: 50px;
    }
}

@media (max-width: 576px) {
    .table-responsive {
        font-size: 0.8rem;
    }
    
    .table th, .table td {
        padding: 8px 6px;
        font-size: 0.8rem;
    }
    
    .table td .btn {
        padding: 3px 6px;
        font-size: 0.7rem;
    }
    
    .sort-handle {
        width: 24px;
        height: 24px;
    }
    
    .sort-handle:before {
        font-size: 12px;
    }
}
</style>
{% endblock %}

{% block content %}
<!-- æ¶ˆæ¯æç¤ºå®¹å™¨ -->
<div id="messageContainer" class="message-container"></div>

<div class="container-fluid">
 
    

    <!-- é¡¹ç›®æ¦‚è§ˆç®¡ç† -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <h2 style="color: #ffffff; margin-bottom: 24px; font-size: 24px; font-weight: 600; text-align: center; background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">ğŸ“Š é¡¹ç›®æ¦‚è§ˆç®¡ç†</h2>
                <div class="table-actions" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;gap:12px;flex-wrap:wrap;">
                    <div style="display:flex;gap:8px;align-items:center;">
                        <input id="overviewSearchInput" type="text" placeholder="æœç´¢ç»Ÿè®¡é¡¹..." style="padding:10px 14px;min-width:220px;">
                    </div>
                    <div class="btn-group" style="display:flex;gap:12px;align-items:center;">
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#overviewModal">
                            <i class="fas fa-plus"></i> æ·»åŠ ç»Ÿè®¡é¡¹
                        </button>
                        <button id="saveOverviewOrderBtn" class="btn btn-success" style="display:none;">ğŸ’¾ ä¿å­˜æ’åº</button>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th width="50">æ’åº</th>
                                <th>åç§°</th>
                                <th>æ•°å€¼</th>
                                <th>å›¾æ ‡</th>
                                <th>æè¿°</th>
                                <th>çŠ¶æ€</th>
                                <th width="150">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="overviewTableBody">
                            <!-- æ¦‚è§ˆæ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- ç«èµ›è·å¥–ç®¡ç† -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <h2 style="color: #ffffff; margin-bottom: 24px; font-size: 24px; font-weight: 600; text-align: center; background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">ğŸ† ç«èµ›è·å¥–ç®¡ç†</h2>
                <div class="table-actions" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;gap:12px;flex-wrap:wrap;">
                    <div style="display:flex;gap:8px;align-items:center;">
                        <input id="awardSearchInput" type="text" placeholder="æœç´¢è·å¥–è®°å½•..." style="padding:10px 14px;min-width:220px;">
                        <select id="awardLevelFilter" style="padding:10px 14px;">
                            <option value="">å…¨éƒ¨ç­‰çº§</option>
                            <option value="ç‰¹ç­‰å¥–">ç‰¹ç­‰å¥–</option>
                            <option value="ä¸€ç­‰å¥–">ä¸€ç­‰å¥–</option>
                            <option value="äºŒç­‰å¥–">äºŒç­‰å¥–</option>
                            <option value="ä¸‰ç­‰å¥–">ä¸‰ç­‰å¥–</option>
                            <option value="ä¼˜ç§€å¥–">ä¼˜ç§€å¥–</option>
                        </select>
                    </div>
                    <div class="btn-group" style="display:flex;gap:12px;align-items:center;">
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#awardModal">
                            <i class="fas fa-plus"></i> æ·»åŠ è·å¥–è®°å½•
                        </button>
                        <button id="saveAwardOrderBtn" class="btn btn-success" style="display:none;">ğŸ’¾ ä¿å­˜æ’åº</button>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th width="50">æ’åº</th>
                                <th>æ ‡é¢˜</th>
                                <th>ç«èµ›åç§°</th>
                                <th>è·å¥–ç­‰çº§</th>
                                <th>è·å¥–è€…</th>
                                <th>æ¯”èµ›æ—¥æœŸ</th>
                                <th>çŠ¶æ€</th>
                                <th width="150">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="awardTableBody">
                            <!-- è·å¥–æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>


<!-- ç«èµ›è·å¥–æ¨¡æ€æ¡† -->
<div class="modal fade" id="awardModal" tabindex="-1" aria-labelledby="awardModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="awardModalLabel">æ·»åŠ è·å¥–è®°å½•</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="å…³é—­" tabindex="0"></button>
            </div>
            <form id="awardForm" novalidate>
                <div class="modal-body">
                    <input type="hidden" id="awardId" name="id">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="awardTitle" class="form-label">æ ‡é¢˜ <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="awardTitle" name="title" required 
                                       placeholder="è¯·è¾“å…¥è·å¥–æ ‡é¢˜" autocomplete="off">
                                <div class="invalid-feedback">è¯·è¾“å…¥è·å¥–æ ‡é¢˜</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="awardCompetitionName" class="form-label">ç«èµ›åç§° <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="awardCompetitionName" name="competition_name" required 
                                       placeholder="è¯·è¾“å…¥ç«èµ›åç§°" autocomplete="off">
                                <div class="invalid-feedback">è¯·è¾“å…¥ç«èµ›åç§°</div>
                            </div>
                        </div>
                    </div>
                    <div class="row g-3 mt-2">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="awardLevel" class="form-label">è·å¥–ç­‰çº§ <span class="text-danger">*</span></label>
                                <select class="form-select" id="awardLevel" name="award_level" required>
                                    <option value="">è¯·é€‰æ‹©ç­‰çº§</option>
                                    <option value="ç‰¹ç­‰å¥–">ç‰¹ç­‰å¥–</option>
                                    <option value="ä¸€ç­‰å¥–">ä¸€ç­‰å¥–</option>
                                    <option value="äºŒç­‰å¥–">äºŒç­‰å¥–</option>
                                    <option value="ä¸‰ç­‰å¥–">ä¸‰ç­‰å¥–</option>
                                    <option value="ä¼˜ç§€å¥–">ä¼˜ç§€å¥–</option>
                                </select>
                                <div class="invalid-feedback">è¯·é€‰æ‹©è·å¥–ç­‰çº§</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="awardWinnerName" class="form-label">è·å¥–è€…</label>
                                <input type="text" class="form-control" id="awardWinnerName" name="winner_name" 
                                       placeholder="è¯·è¾“å…¥è·å¥–è€…å§“å" autocomplete="off">
                            </div>
                        </div>
                    </div>
                    <div class="row g-3 mt-2">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="awardCompetitionDate" class="form-label">æ¯”èµ›æ—¥æœŸ</label>
                                <input type="date" class="form-control" id="awardCompetitionDate" name="competition_date">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="awardCompetitionLocation" class="form-label">æ¯”èµ›åœ°ç‚¹</label>
                                <input type="text" class="form-control" id="awardCompetitionLocation" name="competition_location" 
                                       placeholder="è¯·è¾“å…¥æ¯”èµ›åœ°ç‚¹" autocomplete="off">
                            </div>
                        </div>
                    </div>
                    <div class="row g-3 mt-2">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="awardTeamScore" class="form-label">å›¢é˜Ÿå¾—åˆ†</label>
                                <input type="text" class="form-control" id="awardTeamScore" name="team_score" 
                                       placeholder="å¦‚ï¼š95.5åˆ†" autocomplete="off">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="awardImageUrl" class="form-label">å›¾ç‰‡é“¾æ¥</label>
                                <input type="url" class="form-control" id="awardImageUrl" name="image_url" 
                                       placeholder="https://example.com/image.jpg" autocomplete="off">
                            </div>
                        </div>
                    </div>
                    <div class="form-group mt-3">
                        <label for="awardDescription" class="form-label">æè¿°</label>
                        <textarea class="form-control" id="awardDescription" name="description" rows="3" 
                                  placeholder="è¯·è¾“å…¥è·å¥–æè¿°"></textarea>
                    </div>
                    <div class="row g-3 mt-2">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="awardStatus" class="form-label">çŠ¶æ€</label>
                                <select class="form-select" id="awardStatus" name="status">
                                    <option value="active">å¯ç”¨</option>
                                    <option value="inactive">ç¦ç”¨</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="awardOrderIndex" class="form-label">æ’åº</label>
                                <input type="number" class="form-control" id="awardOrderIndex" name="order_index" 
                                       value="0" min="0" autocomplete="off">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" tabindex="0">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-primary" id="saveAwardBtn">
                        <span class="btn-text">ä¿å­˜</span>
                        <span class="btn-loading" style="display: none;">
                            <i class="fas fa-spinner fa-spin"></i> ä¿å­˜ä¸­...
                        </span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- é¡¹ç›®æ¦‚è§ˆæ¨¡æ€æ¡† -->
<div class="modal fade" id="overviewModal" tabindex="-1" aria-labelledby="overviewModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="overviewModalLabel">æ·»åŠ ç»Ÿè®¡é¡¹</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="å…³é—­" tabindex="0"></button>
            </div>
            <form id="overviewForm" novalidate>
                <div class="modal-body">
                    <input type="hidden" id="overviewId" name="id">
                    <div class="form-group">
                        <label for="overviewName" class="form-label">åç§° <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="overviewName" name="name" required 
                               placeholder="è¯·è¾“å…¥ç»Ÿè®¡é¡¹åç§°" autocomplete="off">
                        <div class="invalid-feedback">è¯·è¾“å…¥ç»Ÿè®¡é¡¹åç§°</div>
                    </div>
                    <div class="form-group mt-3">
                        <label for="overviewValue" class="form-label">æ•°å€¼</label>
                        <input type="number" class="form-control" id="overviewValue" name="value" value="0" min="0" 
                               autocomplete="off">
                    </div>
                    <div class="form-group mt-3">
                        <label for="overviewIcon" class="form-label">å›¾æ ‡</label>
                        <input type="text" class="form-control" id="overviewIcon" name="icon" value="fa-chart-bar" 
                               placeholder="FontAwesomeå›¾æ ‡ç±»åï¼Œå¦‚ï¼šfa-chart-bar" autocomplete="off">
                    </div>
                    <div class="form-group mt-3">
                        <label for="overviewDescription" class="form-label">æè¿°</label>
                        <textarea class="form-control" id="overviewDescription" name="description" rows="3" 
                                  placeholder="è¯·è¾“å…¥ç»Ÿè®¡é¡¹æè¿°"></textarea>
                    </div>
                    <div class="row g-3 mt-2">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="overviewStatus" class="form-label">çŠ¶æ€</label>
                                <select class="form-select" id="overviewStatus" name="status">
                                    <option value="active">å¯ç”¨</option>
                                    <option value="inactive">ç¦ç”¨</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="overviewOrderIndex" class="form-label">æ’åº</label>
                                <input type="number" class="form-control" id="overviewOrderIndex" name="order_index" 
                                       value="0" min="0" autocomplete="off">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" tabindex="0">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-primary" id="saveOverviewBtn">
                        <span class="btn-text">ä¿å­˜</span>
                        <span class="btn-loading" style="display: none;">
                            <i class="fas fa-spinner fa-spin"></i> ä¿å­˜ä¸­...
                        </span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- åˆ é™¤ç¡®è®¤æ¨¡æ€æ¡† -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel">ç¡®è®¤åˆ é™¤</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="å…³é—­" tabindex="0"></button>
            </div>
            <div class="modal-body">
                <div class="text-center">
                    <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: #f59e0b; margin-bottom: 1rem;"></i>
                    <p class="mb-0">ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ</p>
                    <p class="text-muted small">æ­¤æ“ä½œä¸å¯æ¢å¤ï¼Œè¯·è°¨æ…æ“ä½œã€‚</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" tabindex="0">å–æ¶ˆ</button>
                <button type="button" class="btn btn-danger" id="confirmDelete" tabindex="0">
                    <span class="btn-text">ç¡®å®šåˆ é™¤</span>
                    <span class="btn-loading" style="display: none;">
                        <i class="fas fa-spinner fa-spin"></i> åˆ é™¤ä¸­...
                    </span>
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<!-- ä½¿ç”¨æ›´ç¨³å®šçš„Sortable.js CDNé“¾æ¥ -->
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script>
let currentDeleteId = null;
let currentDeleteType = null;

// å…¨å±€æ¶ˆæ¯æç¤ºç³»ç»Ÿ
function showMessage(text, type = 'info') {
    const container = document.getElementById('messageContainer');
    const message = document.createElement('div');
    message.className = `message ${type}`;
    
    const iconMap = {
        success: 'âœ“',
        error: 'âœ•',
        info: 'â“˜'
    };
    
    message.innerHTML = `
        <span class="message-icon">${iconMap[type] || 'â“˜'}</span>
        <span>${text}</span>
    `;
    
    container.appendChild(message);
    
    // è§¦å‘æ˜¾ç¤ºåŠ¨ç”»
    setTimeout(() => message.classList.add('show'), 100);
    
    // 3ç§’åè‡ªåŠ¨ç§»é™¤
    setTimeout(() => {
        message.classList.remove('show');
        setTimeout(() => {
            if (message.parentNode) {
                message.parentNode.removeChild(message);
            }
        }, 300);
    }, 3000);
}

// é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    console.log('ğŸš€ å¼€å§‹åˆå§‹åŒ–è·å¥–è®°å½•å’Œé¡¹ç›®æ¦‚è§ˆç®¡ç†ç³»ç»Ÿ...');
    
    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    showMessage('æ­£åœ¨åŠ è½½æ•°æ®...', 'info');
    
    // æ£€æŸ¥å¿…è¦çš„ä¾èµ–
    if (typeof bootstrap === 'undefined') {
        console.error('âŒ Bootstrap æœªåŠ è½½');
        showMessage('Bootstrap åº“æœªåŠ è½½ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'error');
        return;
    }
    
    // æ·»åŠ é”™è¯¯å¤„ç†
    window.addEventListener('error', function(event) {
        console.error('JavaScripté”™è¯¯:', event.error);
        showMessage(`JavaScripté”™è¯¯: ${event.message}`, 'error');
    });
    
    window.addEventListener('unhandledrejection', function(event) {
        console.error('æœªå¤„ç†çš„Promiseæ‹’ç»:', event.reason);
        showMessage(`Promiseé”™è¯¯: ${event.reason}`, 'error');
    });
    
    // å¹¶è¡ŒåŠ è½½æ•°æ®ï¼Œå³ä½¿æŸä¸ªæ¨¡å—å¤±è´¥ä¹Ÿç»§ç»­åˆå§‹åŒ–å…¶ä»–åŠŸèƒ½
    Promise.allSettled([
        loadAwards(),
        loadOverviews()
    ]).then((results) => {
        console.log('âœ… æ•°æ®åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–åŠŸèƒ½...');
        
        // æ£€æŸ¥æ¯ä¸ªæ¨¡å—çš„åŠ è½½ç»“æœ
        results.forEach((result, index) => {
            const moduleNames = ['è·å¥–è®°å½•', 'é¡¹ç›®æ¦‚è§ˆ'];
            if (result.status === 'fulfilled') {
                console.log(`âœ… ${moduleNames[index]}æ¨¡å—åŠ è½½æˆåŠŸ`);
            } else {
                console.error(`âŒ ${moduleNames[index]}æ¨¡å—åŠ è½½å¤±è´¥:`, result.reason);
                showMessage(`${moduleNames[index]}æ¨¡å—åŠ è½½å¤±è´¥: ${result.reason}`, 'error');
            }
        });
        
        // æŒ‰é¡ºåºåˆå§‹åŒ–åŠŸèƒ½
        try {
            initializeSortable();
            console.log('âœ… æ‹–æ‹½æ’åºåˆå§‹åŒ–å®Œæˆ');
            
            initializeForms();
            console.log('âœ… è¡¨å•åˆå§‹åŒ–å®Œæˆ');
            
            initializeSearch();
            console.log('âœ… æœç´¢åŠŸèƒ½åˆå§‹åŒ–å®Œæˆ');
            
            setupFormValidation();
            console.log('âœ… è¡¨å•éªŒè¯åˆå§‹åŒ–å®Œæˆ');
            
            initializeModalEvents();
            console.log('âœ… æ¨¡æ€æ¡†äº‹ä»¶åˆå§‹åŒ–å®Œæˆ');
            
            // é¡µé¢åŠ è½½å®Œæˆæç¤º
            setTimeout(() => {
                showMessage('è·å¥–è®°å½•å’Œé¡¹ç›®æ¦‚è§ˆç®¡ç†ç³»ç»Ÿå·²å°±ç»ªï¼', 'success');
                console.log('ğŸ‰ è·å¥–è®°å½•å’Œé¡¹ç›®æ¦‚è§ˆç®¡ç†ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆï¼');
            }, 500);
        } catch (error) {
            console.error('âŒ åŠŸèƒ½åˆå§‹åŒ–å¤±è´¥:', error);
            showMessage('åŠŸèƒ½åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•', 'error');
        }
    }).catch((error) => {
        console.error('âŒ åˆå§‹åŒ–è¿‡ç¨‹å‡ºé”™:', error);
        showMessage('ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•', 'error');
    });
});

// åˆå§‹åŒ–æ‹–æ‹½æ’åº
function initializeSortable() {
    try {
        // æ£€æŸ¥Sortableæ˜¯å¦å¯ç”¨
        if (typeof Sortable === 'undefined') {
            console.warn('âš ï¸ Sortableåº“æœªåŠ è½½ï¼Œè·³è¿‡æ‹–æ‹½æ’åºåˆå§‹åŒ–');
            return;
        }
        

        // è·å¥–è®°å½•æ’åº
        const awardTableBody = document.getElementById('awardTableBody');
        if (awardTableBody) {
            new Sortable(awardTableBody, {
                animation: 150,
                handle: '.sort-handle',
                onUpdate: function(evt) {
                    const saveBtn = document.getElementById('saveAwardOrderBtn');
                    if (saveBtn) {
                        saveBtn.style.display = 'inline-block';
                    }
                }
            });
        }
        
        // é¡¹ç›®æ¦‚è§ˆæ’åº
        const overviewTableBody = document.getElementById('overviewTableBody');
        if (overviewTableBody) {
            new Sortable(overviewTableBody, {
                animation: 150,
                handle: '.sort-handle',
                onUpdate: function(evt) {
                    const saveBtn = document.getElementById('saveOverviewOrderBtn');
                    if (saveBtn) {
                        saveBtn.style.display = 'inline-block';
                    }
                }
            });
        }
    } catch (error) {
        console.error('âŒ åˆå§‹åŒ–æ‹–æ‹½æ’åºå¤±è´¥:', error);
        showMessage('æ‹–æ‹½æ’åºåŠŸèƒ½åˆå§‹åŒ–å¤±è´¥ï¼Œä½†ä¸å½±å“å…¶ä»–åŠŸèƒ½', 'error');
    }
}

// åˆå§‹åŒ–æœç´¢åŠŸèƒ½
function initializeSearch() {
    // è·å¥–è®°å½•æœç´¢
    const awardSearchInput = document.getElementById('awardSearchInput');
    const awardLevelFilter = document.getElementById('awardLevelFilter');
    
    if (awardSearchInput) {
        awardSearchInput.addEventListener('input', applyAwardFilter);
    }
    if (awardLevelFilter) {
        awardLevelFilter.addEventListener('change', applyAwardFilter);
    }
    
    // é¡¹ç›®æ¦‚è§ˆæœç´¢
    const overviewSearchInput = document.getElementById('overviewSearchInput');
    
    if (overviewSearchInput) {
        overviewSearchInput.addEventListener('input', applyOverviewFilter);
    }
}

// è·å¥–è®°å½•è¿‡æ»¤
function applyAwardFilter() {
    const searchInput = document.getElementById('awardSearchInput');
    const levelFilter = document.getElementById('awardLevelFilter');
    
    if (!searchInput || !levelFilter) return;
    
    const keyword = (searchInput.value || '').trim().toLowerCase();
    const level = (levelFilter.value || '').trim();
    
    const filteredAwards = window.awardData ? window.awardData.filter(award => {
        const matchKeyword = !keyword || 
            (award.title && award.title.toLowerCase().includes(keyword)) ||
            (award.competition_name && award.competition_name.toLowerCase().includes(keyword)) ||
            (award.winner_name && award.winner_name.toLowerCase().includes(keyword));
        
        const matchLevel = !level || award.award_level === level;
        
        return matchKeyword && matchLevel;
    }) : [];
    
    renderAwardTable(filteredAwards);
}

// é¡¹ç›®æ¦‚è§ˆè¿‡æ»¤
function applyOverviewFilter() {
    const searchInput = document.getElementById('overviewSearchInput');
    
    if (!searchInput) return;
    
    const keyword = (searchInput.value || '').trim().toLowerCase();
    
    const filteredOverviews = window.overviewData ? window.overviewData.filter(overview => {
        return !keyword || 
            (overview.name && overview.name.toLowerCase().includes(keyword)) ||
            (overview.description && overview.description.toLowerCase().includes(keyword));
    }) : [];
    
    renderOverviewTable(filteredOverviews);
}

// åˆå§‹åŒ–è¡¨å•
function initializeForms() {
    // è·å¥–è®°å½•è¡¨å•
    const awardForm = document.getElementById('awardForm');
    if (awardForm) {
        awardForm.addEventListener('submit', function(e) {
            e.preventDefault();
            saveAward();
        });
    }
    
    // é¡¹ç›®æ¦‚è§ˆè¡¨å•
    const overviewForm = document.getElementById('overviewForm');
    if (overviewForm) {
        overviewForm.addEventListener('submit', function(e) {
            e.preventDefault();
            saveOverview();
        });
    }
    
    // åˆ é™¤ç¡®è®¤
    const confirmDeleteBtn = document.getElementById('confirmDelete');
    if (confirmDeleteBtn) {
        confirmDeleteBtn.addEventListener('click', function() {
            if (currentDeleteId && currentDeleteType) {
                deleteItem(currentDeleteId, currentDeleteType);
            }
        });
    }
    
    // æ’åºæŒ‰é’®äº‹ä»¶
    const saveAwardOrderBtn = document.getElementById('saveAwardOrderBtn');
    if (saveAwardOrderBtn) {
        saveAwardOrderBtn.addEventListener('click', updateAwardOrder);
    }
    
    const saveOverviewOrderBtn = document.getElementById('saveOverviewOrderBtn');
    if (saveOverviewOrderBtn) {
        saveOverviewOrderBtn.addEventListener('click', updateOverviewOrder);
    }
}



// åŠ è½½è·å¥–è®°å½•æ•°æ®
function loadAwards() {
    console.log('ğŸ” å¼€å§‹åŠ è½½è·å¥–è®°å½•æ•°æ®...');
    return fetch(getApiUrl('/api/admin/algorithm-awards'))
        .then(response => {
            console.log('è·å¥–è®°å½•APIå“åº”çŠ¶æ€:', response.status);
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            return response.json();
        })
        .then(data => {
            console.log('è·å¥–è®°å½•APIå“åº”æ•°æ®:', data);
            console.log('æ•°æ®ç±»å‹:', typeof data);
            console.log('æ˜¯å¦ä¸ºæ•°ç»„:', Array.isArray(data));
            
            if (Array.isArray(data)) {
                window.awardData = data;
                console.log('è·å¥–è®°å½•æ•°æ®å·²è®¾ç½®åˆ°window.awardData');
                renderAwardTable(data);
                console.log(`âœ… æˆåŠŸåŠ è½½ ${data.length} ä¸ªè·å¥–è®°å½•`);
                return data;
            } else if (data && typeof data === 'object' && data.error) {
                console.error('åŠ è½½è·å¥–è®°å½•å¤±è´¥:', data.error);
                throw new Error(data.error || 'åŠ è½½è·å¥–è®°å½•å¤±è´¥');
            } else {
                console.error('APIè¿”å›çš„æ•°æ®æ ¼å¼ä¸æ­£ç¡®:', data);
                throw new Error('APIè¿”å›çš„æ•°æ®æ ¼å¼ä¸æ­£ç¡®');
            }
        })
        .catch(error => {
            console.error('åŠ è½½è·å¥–è®°å½•å‡ºé”™:', error);
            showMessage(`åŠ è½½è·å¥–è®°å½•å‡ºé”™: ${error.message}`, 'error');
            // æ˜¾ç¤ºç©ºçŠ¶æ€
            renderAwardTable([]);
            // ä¸æŠ›å‡ºé”™è¯¯ï¼Œè®©å…¶ä»–æ¨¡å—ç»§ç»­åŠ è½½
            return [];
        });
}

// æ¸²æŸ“è·å¥–è®°å½•è¡¨æ ¼
function renderAwardTable(awards) {
    const tbody = document.getElementById('awardTableBody');
    tbody.innerHTML = '';
    
    if (awards.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="8" class="empty-state">
                    <i class="fas fa-trophy"></i>
                    <p>æš‚æ— è·å¥–è®°å½•</p>
                    <p class="sub-text">ç‚¹å‡»"æ·»åŠ è·å¥–è®°å½•"æŒ‰é’®æ·»åŠ æ–°çš„è·å¥–è®°å½•</p>
                </td>
            </tr>
        `;
        return;
    }
    
    awards.forEach(award => {
        const row = document.createElement('tr');
        row.className = 'sortable-item';
        row.setAttribute('data-id', award.id);
        const date = award.competition_date ? new Date(award.competition_date).toLocaleDateString() : '-';
        row.innerHTML = `
            <td style="text-align: center;">
                <span class="sort-handle" title="æ‹–æ‹½æ’åº"></span>
            </td>
            <td>
                <div style="font-weight: 600; color: #ffffff; font-size: 1rem; margin-bottom: 4px;">${award.title || ''}</div>
                ${award.description ? `<div style="color: rgba(255, 255, 255, 0.7); font-size: 0.85rem; line-height: 1.4;">${award.description.substring(0, 50)}${award.description.length > 50 ? '...' : ''}</div>` : ''}
            </td>
            <td>
                <div style="color: #ffffff; font-weight: 500; font-size: 0.95rem;">${award.competition_name || ''}</div>
                ${award.competition_location ? `<div style="color: rgba(255, 255, 255, 0.6); font-size: 0.8rem; margin-top: 2px;">ğŸ“ ${award.competition_location}</div>` : ''}
            </td>
            <td style="text-align: center;">
                <span class="badge bg-warning" style="font-size: 0.8rem; padding: 8px 12px; background: linear-gradient(135deg, #f59e0b, #d97706) !important;">
                    ğŸ† ${award.award_level || ''}
                </span>
            </td>
            <td style="text-align: center;">
                <div style="color: #ffffff; font-weight: 500; font-size: 0.95rem;">${award.winner_name || '-'}</div>
                ${award.team_score ? `<div style="color: rgba(255, 255, 255, 0.7); font-size: 0.8rem; margin-top: 2px;">${award.team_score}</div>` : ''}
            </td>
            <td style="text-align: center;">
                <div style="color: rgba(255, 255, 255, 0.9); font-weight: 500; font-size: 0.9rem;">${date}</div>
            </td>
            <td style="text-align: center;">
                <span class="badge ${award.status === 'active' ? 'bg-success' : 'bg-secondary'}" style="font-size: 0.8rem; padding: 8px 12px;">
                    ${award.status === 'active' ? 'âœ… å¯ç”¨' : 'âŒ ç¦ç”¨'}
                </span>
            </td>
            <td style="text-align: center;">
                <div style="display: flex; gap: 8px; justify-content: center; flex-wrap: wrap;">
                    <button class="btn btn-sm" onclick="editAward(${award.id})" title="ç¼–è¾‘" style="background: linear-gradient(135deg, #667eea, #764ba2); border: 1px solid rgba(255, 255, 255, 0.2);">
                        âœï¸ ç¼–è¾‘
                    </button>
                    <button class="btn btn-sm btn-danger" onclick="showDeleteModal(${award.id}, 'award')" title="åˆ é™¤" style="background: linear-gradient(135deg, #ef4444, #dc2626); border: 1px solid rgba(239, 68, 68, 0.3);">
                        ğŸ—‘ï¸ åˆ é™¤
                    </button>
                </div>
            </td>
        `;
        tbody.appendChild(row);
    });
}

// åŠ è½½é¡¹ç›®æ¦‚è§ˆæ•°æ®
function loadOverviews() {
    console.log('ğŸ” å¼€å§‹åŠ è½½é¡¹ç›®æ¦‚è§ˆæ•°æ®...');
    return fetch(getApiUrl('/api/admin/project-overview'))
        .then(response => {
            console.log('é¡¹ç›®æ¦‚è§ˆAPIå“åº”çŠ¶æ€:', response.status);
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            return response.json();
        })
        .then(data => {
            console.log('é¡¹ç›®æ¦‚è§ˆAPIå“åº”æ•°æ®:', data);
            console.log('æ•°æ®ç±»å‹:', typeof data);
            console.log('æ˜¯å¦ä¸ºæ•°ç»„:', Array.isArray(data));
            
            if (Array.isArray(data)) {
                window.overviewData = data;
                console.log('é¡¹ç›®æ¦‚è§ˆæ•°æ®å·²è®¾ç½®åˆ°window.overviewData');
                renderOverviewTable(data);
                console.log(`âœ… æˆåŠŸåŠ è½½ ${data.length} ä¸ªç»Ÿè®¡é¡¹`);
                return data;
            } else if (data && typeof data === 'object' && data.error) {
                console.error('åŠ è½½é¡¹ç›®æ¦‚è§ˆå¤±è´¥:', data.error);
                throw new Error(data.error || 'åŠ è½½é¡¹ç›®æ¦‚è§ˆå¤±è´¥');
            } else {
                console.error('APIè¿”å›çš„æ•°æ®æ ¼å¼ä¸æ­£ç¡®:', data);
                throw new Error('APIè¿”å›çš„æ•°æ®æ ¼å¼ä¸æ­£ç¡®');
            }
        })
        .catch(error => {
            console.error('åŠ è½½é¡¹ç›®æ¦‚è§ˆå‡ºé”™:', error);
            showMessage(`åŠ è½½é¡¹ç›®æ¦‚è§ˆå‡ºé”™: ${error.message}`, 'error');
            // æ˜¾ç¤ºç©ºçŠ¶æ€
            renderOverviewTable([]);
            // ä¸æŠ›å‡ºé”™è¯¯ï¼Œè®©å…¶ä»–æ¨¡å—ç»§ç»­åŠ è½½
            return [];
        });
}

// æ¸²æŸ“é¡¹ç›®æ¦‚è§ˆè¡¨æ ¼
function renderOverviewTable(overviews) {
    const tbody = document.getElementById('overviewTableBody');
    tbody.innerHTML = '';
    
    if (overviews.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="7" class="empty-state">
                    <i class="fas fa-chart-bar"></i>
                    <p>æš‚æ— ç»Ÿè®¡é¡¹æ•°æ®</p>
                    <p class="sub-text">ç‚¹å‡»"æ·»åŠ ç»Ÿè®¡é¡¹"æŒ‰é’®æ·»åŠ æ–°çš„ç»Ÿè®¡é¡¹</p>
                </td>
            </tr>
        `;
        return;
    }
    
    overviews.forEach(overview => {
        const row = document.createElement('tr');
        row.className = 'sortable-item';
        row.setAttribute('data-id', overview.id);
        row.innerHTML = `
            <td style="text-align: center;">
                <span class="sort-handle" title="æ‹–æ‹½æ’åº"></span>
            </td>
            <td>
                <div style="font-weight: 600; color: #ffffff; font-size: 1rem; margin-bottom: 4px;">${overview.name || ''}</div>
                ${overview.description ? `<div style="color: rgba(255, 255, 255, 0.7); font-size: 0.85rem; line-height: 1.4;">${overview.description.substring(0, 50)}${overview.description.length > 50 ? '...' : ''}</div>` : ''}
            </td>
            <td style="text-align: center;">
                <div style="font-size: 1.5em; font-weight: bold; color: #667eea; text-shadow: 0 2px 4px rgba(102, 126, 234, 0.3);">${overview.value || 0}</div>
            </td>
            <td style="text-align: center;">
                <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <i class="fas ${overview.icon || 'fa-chart-bar'}" style="color: #764ba2; font-size: 1.2rem; text-shadow: 0 2px 4px rgba(118, 75, 162, 0.3);"></i>
                    <span style="color: rgba(255, 255, 255, 0.8); font-size: 0.8rem;">${overview.icon || 'fa-chart-bar'}</span>
                </div>
            </td>
            <td>
                <div style="color: rgba(255, 255, 255, 0.9); font-size: 0.9rem; line-height: 1.4;">${overview.description || '-'}</div>
            </td>
            <td style="text-align: center;">
                <span class="badge ${overview.status === 'active' ? 'bg-success' : 'bg-secondary'}" style="font-size: 0.8rem; padding: 8px 12px;">
                    ${overview.status === 'active' ? 'âœ… å¯ç”¨' : 'âŒ ç¦ç”¨'}
                </span>
            </td>
            <td style="text-align: center;">
                <div style="display: flex; gap: 8px; justify-content: center; flex-wrap: wrap;">
                    <button class="btn btn-sm" onclick="editOverview(${overview.id})" title="ç¼–è¾‘" style="background: linear-gradient(135deg, #667eea, #764ba2); border: 1px solid rgba(255, 255, 255, 0.2);">
                        âœï¸ ç¼–è¾‘
                    </button>
                    <button class="btn btn-sm btn-danger" onclick="showDeleteModal(${overview.id}, 'overview')" title="åˆ é™¤" style="background: linear-gradient(135deg, #ef4444, #dc2626); border: 1px solid rgba(239, 68, 68, 0.3);">
                        ğŸ—‘ï¸ åˆ é™¤
                    </button>
                </div>
            </td>
        `;
        tbody.appendChild(row);
    });
}



// ç¼–è¾‘è·å¥–è®°å½•
function editAward(id) {
    fetch(`/api/admin/algorithm-awards/${id}`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const award = data.award;
                document.getElementById('awardId').value = award.id;
                document.getElementById('awardTitle').value = award.title;
                document.getElementById('awardCompetitionName').value = award.competition_name;
                document.getElementById('awardLevel').value = award.award_level;
                document.getElementById('awardWinnerName').value = award.winner_name || '';
                document.getElementById('awardCompetitionDate').value = award.competition_date || '';
                document.getElementById('awardCompetitionLocation').value = award.competition_location || '';
                document.getElementById('awardTeamScore').value = award.team_score || '';
                document.getElementById('awardImageUrl').value = award.image_url || '';
                document.getElementById('awardDescription').value = award.description || '';
                document.getElementById('awardStatus').value = award.status;
                document.getElementById('awardOrderIndex').value = award.order_index;
                
                document.getElementById('awardModalLabel').textContent = 'ç¼–è¾‘è·å¥–è®°å½•';
                const modal = new bootstrap.Modal(document.getElementById('awardModal'));
                modal.show();
            }
        })
        .catch(error => {
            console.error('è·å–è·å¥–è®°å½•æ•°æ®å‡ºé”™:', error);
            showMessage('è·å–è·å¥–è®°å½•æ•°æ®å¤±è´¥', 'error');
        });
}

// ç¼–è¾‘é¡¹ç›®æ¦‚è§ˆ
function editOverview(id) {
    fetch(`/api/admin/project-overview/${id}`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const overview = data.overview;
                document.getElementById('overviewId').value = overview.id;
                document.getElementById('overviewName').value = overview.name;
                document.getElementById('overviewValue').value = overview.value;
                document.getElementById('overviewIcon').value = overview.icon;
                document.getElementById('overviewDescription').value = overview.description || '';
                document.getElementById('overviewStatus').value = overview.status;
                document.getElementById('overviewOrderIndex').value = overview.order_index;
                
                document.getElementById('overviewModalLabel').textContent = 'ç¼–è¾‘ç»Ÿè®¡é¡¹';
                const modal = new bootstrap.Modal(document.getElementById('overviewModal'));
                modal.show();
            }
        })
        .catch(error => {
            console.error('è·å–é¡¹ç›®æ¦‚è§ˆæ•°æ®å‡ºé”™:', error);
            showMessage('è·å–é¡¹ç›®æ¦‚è§ˆæ•°æ®å¤±è´¥', 'error');
        });
}



// ä¿å­˜è·å¥–è®°å½•
function saveAward() {
    const form = document.getElementById('awardForm');
    const submitBtn = document.getElementById('saveAwardBtn');
    
    // è¡¨å•éªŒè¯
    if (!form.checkValidity()) {
        form.classList.add('was-validated');
        return;
    }
    
    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    submitBtn.classList.add('loading');
    
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    
    const id = document.getElementById('awardId').value;
    const url = id ? `/api/admin/algorithm-awards/${id}` : '/api/admin/algorithm-awards';
    const method = id ? 'PUT' : 'POST';
    
    console.log('ä¿å­˜è·å¥–è®°å½•æ•°æ®:', data);
    console.log('è¯·æ±‚URL:', url);
    console.log('è¯·æ±‚æ–¹æ³•:', method);
    
    fetch(url, {
        method: method,
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
    })
    .then(response => {
        console.log('ä¿å­˜è·å¥–è®°å½•å“åº”çŠ¶æ€:', response.status);
        return response.json();
    })
    .then(result => {
        console.log('ä¿å­˜è·å¥–è®°å½•å“åº”æ•°æ®:', result);
        if (result.success) {
            showMessage(result.message || 'è·å¥–è®°å½•ä¿å­˜æˆåŠŸ', 'success');
            bootstrap.Modal.getInstance(document.getElementById('awardModal')).hide();
            resetAwardForm();
            // é‡æ–°åŠ è½½æ•°æ®
            loadAwards().then(() => {
                console.log('è·å¥–è®°å½•æ•°æ®é‡æ–°åŠ è½½å®Œæˆ');
            });
        } else {
            showMessage(result.error || 'ä¿å­˜å¤±è´¥', 'error');
        }
    })
    .catch(error => {
        console.error('ä¿å­˜è·å¥–è®°å½•å‡ºé”™:', error);
        showMessage('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
    })
    .finally(() => {
        // éšè—åŠ è½½çŠ¶æ€
        submitBtn.classList.remove('loading');
    });
}

// ä¿å­˜é¡¹ç›®æ¦‚è§ˆ
function saveOverview() {
    const form = document.getElementById('overviewForm');
    const submitBtn = document.getElementById('saveOverviewBtn');
    
    // è¡¨å•éªŒè¯
    if (!form.checkValidity()) {
        form.classList.add('was-validated');
        return;
    }
    
    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    submitBtn.classList.add('loading');
    
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    
    const id = document.getElementById('overviewId').value;
    const url = id ? `/api/admin/project-overview/${id}` : '/api/admin/project-overview';
    const method = id ? 'PUT' : 'POST';
    
    console.log('ä¿å­˜é¡¹ç›®æ¦‚è§ˆæ•°æ®:', data);
    console.log('è¯·æ±‚URL:', url);
    console.log('è¯·æ±‚æ–¹æ³•:', method);
    
    fetch(url, {
        method: method,
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
    })
    .then(response => {
        console.log('ä¿å­˜é¡¹ç›®æ¦‚è§ˆå“åº”çŠ¶æ€:', response.status);
        return response.json();
    })
    .then(result => {
        console.log('ä¿å­˜é¡¹ç›®æ¦‚è§ˆå“åº”æ•°æ®:', result);
        if (result.success) {
            showMessage(result.message || 'ç»Ÿè®¡é¡¹ä¿å­˜æˆåŠŸ', 'success');
            bootstrap.Modal.getInstance(document.getElementById('overviewModal')).hide();
            resetOverviewForm();
            // é‡æ–°åŠ è½½æ•°æ®
            loadOverviews().then(() => {
                console.log('é¡¹ç›®æ¦‚è§ˆæ•°æ®é‡æ–°åŠ è½½å®Œæˆ');
            });
        } else {
            showMessage(result.error || 'ä¿å­˜å¤±è´¥', 'error');
        }
    })
    .catch(error => {
        console.error('ä¿å­˜é¡¹ç›®æ¦‚è§ˆå‡ºé”™:', error);
        showMessage('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
    })
    .finally(() => {
        // éšè—åŠ è½½çŠ¶æ€
        submitBtn.classList.remove('loading');
    });
}

// æ˜¾ç¤ºåˆ é™¤ç¡®è®¤æ¨¡æ€æ¡†
function showDeleteModal(id, type) {
    currentDeleteId = id;
    currentDeleteType = type;
    new bootstrap.Modal(document.getElementById('deleteModal')).show();
}

// åˆ é™¤é¡¹ç›®
function deleteItem(id, type) {
    const confirmBtn = document.getElementById('confirmDelete');
    
    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    confirmBtn.classList.add('loading');
    
    let url = '';
    let typeName = '';
    switch(type) {
        case 'award':
            url = `/api/admin/algorithm-awards/${id}`;
            typeName = 'è·å¥–è®°å½•';
            break;
        case 'overview':
            url = `/api/admin/project-overview/${id}`;
            typeName = 'ç»Ÿè®¡é¡¹';
            break;
    }
    
    fetch(url, {
        method: 'DELETE'
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            showMessage(result.message || `${typeName}åˆ é™¤æˆåŠŸ`, 'success');
            bootstrap.Modal.getInstance(document.getElementById('deleteModal')).hide();
            
            // é‡æ–°åŠ è½½æ•°æ®
            switch(type) {
                case 'award':
                    loadAwards();
                    break;
                case 'overview':
                    loadOverviews();
                    break;
            }
        } else {
            showMessage(result.error || 'åˆ é™¤å¤±è´¥', 'error');
        }
    })
    .catch(error => {
        console.error('åˆ é™¤å‡ºé”™:', error);
        showMessage('åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
    })
    .finally(() => {
        // éšè—åŠ è½½çŠ¶æ€
        confirmBtn.classList.remove('loading');
    });
}



// æ›´æ–°è·å¥–è®°å½•æ’åº
function updateAwardOrder() {
    const rows = document.querySelectorAll('#awardTableBody tr[data-id]');
    const orderData = [];
    
    rows.forEach((row, index) => {
        const id = row.getAttribute('data-id');
        if (id) {
            orderData.push({
                id: parseInt(id),
                order_index: index
            });
        }
    });
    
    fetch(getApiUrl('/api/admin/algorithm-awards/reorder'), {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ order: orderData })
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            showMessage('è·å¥–è®°å½•æ’åºæ›´æ–°æˆåŠŸ', 'success');
            document.getElementById('saveAwardOrderBtn').style.display = 'none';
        } else {
            showMessage(result.error || 'æ’åºæ›´æ–°å¤±è´¥', 'error');
            loadAwards(); // é‡æ–°åŠ è½½ä»¥æ¢å¤åŸé¡ºåº
        }
    })
    .catch(error => {
        console.error('æ›´æ–°æ’åºå‡ºé”™:', error);
        showMessage('æ’åºæ›´æ–°å¤±è´¥', 'error');
        loadAwards(); // é‡æ–°åŠ è½½ä»¥æ¢å¤åŸé¡ºåº
    });
}

// æ›´æ–°é¡¹ç›®æ¦‚è§ˆæ’åº
function updateOverviewOrder() {
    const rows = document.querySelectorAll('#overviewTableBody tr[data-id]');
    const orderData = [];
    
    rows.forEach((row, index) => {
        const id = row.getAttribute('data-id');
        if (id) {
            orderData.push({
                id: parseInt(id),
                order_index: index
            });
        }
    });
    
    fetch(getApiUrl('/api/admin/project-overview/reorder'), {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ order: orderData })
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            showMessage('ç»Ÿè®¡é¡¹æ’åºæ›´æ–°æˆåŠŸ', 'success');
            document.getElementById('saveOverviewOrderBtn').style.display = 'none';
        } else {
            showMessage(result.error || 'æ’åºæ›´æ–°å¤±è´¥', 'error');
            loadOverviews(); // é‡æ–°åŠ è½½ä»¥æ¢å¤åŸé¡ºåº
        }
    })
    .catch(error => {
        console.error('æ›´æ–°æ’åºå‡ºé”™:', error);
        showMessage('æ’åºæ›´æ–°å¤±è´¥', 'error');
        loadOverviews(); // é‡æ–°åŠ è½½ä»¥æ¢å¤åŸé¡ºåº
    });
}



// é‡ç½®è·å¥–è®°å½•è¡¨å•
function resetAwardForm() {
    document.getElementById('awardForm').reset();
    document.getElementById('awardId').value = '';
    document.getElementById('awardModalLabel').textContent = 'æ·»åŠ è·å¥–è®°å½•';
}

// é‡ç½®é¡¹ç›®æ¦‚è§ˆè¡¨å•
function resetOverviewForm() {
    document.getElementById('overviewForm').reset();
    document.getElementById('overviewId').value = '';
    document.getElementById('overviewModalLabel').textContent = 'æ·»åŠ ç»Ÿè®¡é¡¹';
}



// åˆå§‹åŒ–æ¨¡æ€æ¡†äº‹ä»¶å¤„ç†
function initializeModalEvents() {
    // è·å¥–è®°å½•æ¨¡æ€æ¡†äº‹ä»¶
    const awardModal = document.getElementById('awardModal');
    if (awardModal) {
        awardModal.addEventListener('hidden.bs.modal', function() {
            resetAwardForm();
            // æ¸…é™¤éªŒè¯çŠ¶æ€
            const form = this.querySelector('form');
            if (form) {
                form.classList.remove('was-validated');
            }
        });
        
        awardModal.addEventListener('shown.bs.modal', function() {
            setTimeout(() => {
                const firstInput = this.querySelector('input[type="text"]:not([type="hidden"])');
                if (firstInput) firstInput.focus();
            }, 100);
        });
    }
    
    // é¡¹ç›®æ¦‚è§ˆæ¨¡æ€æ¡†äº‹ä»¶
    const overviewModal = document.getElementById('overviewModal');
    if (overviewModal) {
        overviewModal.addEventListener('hidden.bs.modal', function() {
            resetOverviewForm();
            // æ¸…é™¤éªŒè¯çŠ¶æ€
            const form = this.querySelector('form');
            if (form) {
                form.classList.remove('was-validated');
            }
        });
        
        overviewModal.addEventListener('shown.bs.modal', function() {
            setTimeout(() => {
                const firstInput = this.querySelector('input[type="text"]:not([type="hidden"])');
                if (firstInput) firstInput.focus();
            }, 100);
        });
    }
}

// è¡¨å•éªŒè¯å®æ—¶åé¦ˆ
function setupFormValidation() {
    const forms = document.querySelectorAll('form[novalidate]');
    forms.forEach(form => {
        const inputs = form.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
            input.addEventListener('blur', function() {
                if (this.hasAttribute('required') && !this.value.trim()) {
                    this.classList.add('is-invalid');
                } else {
                    this.classList.remove('is-invalid');
                }
            });
            
            input.addEventListener('input', function() {
                if (this.classList.contains('is-invalid') && this.value.trim()) {
                    this.classList.remove('is-invalid');
                }
            });
        });
    });
}

// ç§»é™¤é‡å¤çš„setupFormValidationè°ƒç”¨ï¼Œå·²åœ¨ä¸»åˆå§‹åŒ–å‡½æ•°ä¸­è°ƒç”¨
</script>
{% endblock %} 