<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ACM实验室 - 管理后台{% endblock %}</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root{--primary:#00f7ff;--secondary:#ff00aa;--dark:#0a0a1a;--darker:#050510;--light:#e0e0ff}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Roboto',sans-serif;background-color:var(--darker);color:var(--light);overflow-x:hidden;min-height:100vh}
        h1,h2,h3,h4,.nav-item{font-family:'Orbitron',sans-serif;font-weight:700}
        .particles{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1}
        .sidebar{width:250px;background:rgba(20,20,40,.8);backdrop-filter:blur(10px);border-right:1px solid rgba(0,247,255,.2);height:100vh;position:fixed;left:0;top:0;z-index:100;display:flex;flex-direction:column}
        .sidebar-header{padding:1.5rem;border-bottom:1px solid rgba(0,247,255,.2)}
        .sidebar-logo{font-size:1.8rem;font-weight:700;color:var(--primary);text-shadow:0 0 10px var(--primary);letter-spacing:2px}
        .sidebar-logo span{color:var(--secondary)}
        .sidebar-nav{flex:1;padding:1.5rem 0;overflow-y:auto}
        .nav-item{padding:.8rem 1.5rem;color:var(--light);text-decoration:none;display:flex;align-items:center;transition:all .3s ease;position:relative;cursor:pointer}
        .nav-item:hover{background:rgba(0,247,255,.1);color:var(--primary)}
        .nav-item.active{background:rgba(0,247,255,.2);color:var(--primary)}
        .nav-item.active::before{content:'';position:absolute;left:0;top:0;height:100%;width:3px;background:var(--primary)}
        .nav-icon{margin-right:.8rem;font-size:1.2rem}
        .sidebar-footer{padding:1rem;border-top:1px solid rgba(0,247,255,.2);text-align:center}
        .user-profile{display:flex;align-items:center;padding:.5rem;border-radius:5px;transition:all .3s ease;cursor:pointer}
        .user-profile:hover{background:rgba(0,247,255,.1)}
        .user-avatar{width:40px;height:40px;border-radius:50%;background:var(--primary);margin-right:.8rem;display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--dark)}
        .user-info{flex:1;text-align:left}
        .user-name{font-weight:700;font-size:.9rem;margin-bottom:.2rem}
        .user-role{font-size:.8rem;color:var(--secondary)}
        .main-content{flex:1;margin-left:250px;min-height:100vh;background:linear-gradient(135deg,var(--darker),var(--dark));position:relative}
        .top-bar{height:70px;background:rgba(20,20,40,.8);backdrop-filter:blur(10px);border-bottom:1px solid rgba(0,247,255,.2);display:flex;align-items:center;justify-content:space-between;padding:0 2rem;position:sticky;top:0;z-index:90}
        .page-title{font-family:'Orbitron',sans-serif;font-size:1.5rem;color:var(--primary)}
        .top-bar-actions{display:flex;align-items:center;gap:1rem}
        .notification-btn,.logout-btn{width:40px;height:40px;border-radius:50%;background:rgba(0,247,255,.1);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .3s ease;position:relative;border:none}
        .notification-btn:hover,.logout-btn:hover{background:rgba(0,247,255,.2)}
        .notification-badge{position:absolute;top:-5px;right:-5px;width:20px;height:20px;background:#ff4757;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.7rem;font-weight:700}
        .content-container{padding:2rem}
        .card{background:rgba(20,20,40,.6);border-radius:10px;padding:1.5rem;margin-bottom:2rem;border:1px solid rgba(0,247,255,.1);transition:all .3s ease}
        .card:hover{transform:translateY(-5px);box-shadow:0 10px 20px rgba(0,247,255,.1);border-color:rgba(0,247,255,.3)}
        .table-responsive{overflow-x:auto}
        .data-table{width:100%;border-collapse:collapse;background:rgba(20,20,40,.8);border-radius:8px;overflow:hidden;box-shadow:0 8px 32px rgba(0,0,0,.3);border:1px solid rgba(0,247,255,.2)}
        .data-table th,.data-table td{padding:1rem;text-align:left;border-bottom:1px solid rgba(0,247,255,.1)}
        .data-table th{color:#ffffff;font-weight:700;text-transform:uppercase;font-size:.8rem;letter-spacing:1px;background:rgba(0,247,255,.1)}
        .data-table td{color:#ffffff;background:rgba(15,15,35,.6)}
        .data-table tr:nth-child(even) td{background:rgba(20,20,40,.7)}
        .data-table tr:hover td{background:rgba(25,25,45,.8);color:#ffffff;transform:scale(1.01);transition:all .2s ease}
        
        /* 表格内容样式增强 */
        .data-table td a{color:#00f7ff;text-decoration:none;font-weight:500}
        .data-table td a:hover{color:#ffffff;text-decoration:underline}
        .table td a{color:#00f7ff;text-decoration:none;font-weight:500}
        .table td a:hover{color:#ffffff;text-decoration:underline}
        .data-table td .btn{font-size:.8rem;padding:.4rem .8rem;margin:.2rem}
        .table td .btn{font-size:.8rem;padding:.4rem .8rem;margin:.2rem}
        .data-table .text-muted{color:rgba(255,255,255,.7) !important}
        .data-table .text-primary{color:#00f7ff !important}
        .data-table .text-success{color:#28a745 !important}
        .data-table .text-warning{color:#ffc107 !important}
        .data-table .text-danger{color:#dc3545 !important}
        .data-table .text-info{color:#17a2b8 !important}
        .table .text-muted{color:rgba(255,255,255,.7) !important}
        .table .text-primary{color:#00f7ff !important}
        .table .text-success{color:#28a745 !important}
        .table .text-warning{color:#ffc107 !important}
        .table .text-danger{color:#dc3545 !important}
        .table .text-info{color:#17a2b8 !important}
        
        /* 兼容其他表格类 */
        .table{width:100%;border-collapse:collapse;background:rgba(20,20,40,.8);border-radius:8px;overflow:hidden;box-shadow:0 8px 32px rgba(0,0,0,.3);border:1px solid rgba(0,247,255,.2)}
        .table th,.table td{padding:1rem;text-align:left;border-bottom:1px solid rgba(0,247,255,.1)}
        .table th{color:#ffffff;font-weight:700;text-transform:uppercase;font-size:.8rem;letter-spacing:1px;background:rgba(0,247,255,.1)}
        .table td{color:#ffffff;background:rgba(15,15,35,.6)}
        .table tr:nth-child(even) td{background:rgba(20,20,40,.7)}
        .table tr:hover td{background:rgba(25,25,45,.8);color:#ffffff;transform:scale(1.01);transition:all .2s ease}
        
        /* 表格内按钮和状态样式 */
        .table td .btn,.data-table td .btn{font-size:.8rem;padding:.4rem .8rem;margin:.2rem;border-radius:6px}
        .table .status,.data-table .status{display:inline-block;padding:.3rem .8rem;border-radius:20px;font-size:.8rem;font-weight:700;color:#ffffff}
        .table .badge,.data-table .badge{display:inline-block;padding:.3rem .6rem;border-radius:15px;font-size:.75rem;font-weight:600;color:#ffffff}
        
        /* 表格内图标和特殊元素样式 */
        .table td i,.data-table td i{color:rgba(255,255,255,.8);margin-right:.5rem}
        .table td .fa,.data-table td .fa{color:rgba(255,255,255,.8);margin-right:.5rem}
        .table td .fas,.data-table td .fas{color:rgba(255,255,255,.8);margin-right:.5rem}
        .table td .far,.data-table td .far{color:rgba(255,255,255,.8);margin-right:.5rem}
        .table td .fab,.data-table td .fab{color:rgba(255,255,255,.8);margin-right:.5rem}
        
        /* 表格响应式优化 */
        @media(max-width:768px){
            .data-table{font-size:.9rem}
            .data-table th,.data-table td{padding:.7rem .5rem}
            .data-table .btn{font-size:.75rem;padding:.3rem .6rem}
        }
        
        /* 表格空状态样式 */
        .table-empty{text-align:center;padding:3rem;color:rgba(255,255,255,.7);font-style:italic}
        .table-loading{text-align:center;padding:2rem;color:rgba(255,255,255,.7)}
        .status{display:inline-block;padding:.3rem .8rem;border-radius:20px;font-size:.8rem;font-weight:700}
        .status-pending{background:rgba(255,193,7,.1);color:#ffc107}
        .status-approved{background:rgba(40,167,69,.1);color:#28a745}
        .status-rejected{background:rgba(220,53,69,.1);color:#dc3545}
        .status-ongoing{background:rgba(0,123,255,.1);color:#007bff}
        .status-completed{background:rgba(40,167,69,.1);color:#28a745}
        .progress-container{width:100%;height:8px;background:rgba(0,247,255,.1);border-radius:4px;margin-top:.5rem;overflow:hidden}
        .progress-bar{height:100%;border-radius:4px;background:linear-gradient(90deg,var(--primary),var(--secondary))}
        .card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;padding-bottom:.5rem;border-bottom:1px solid rgba(0,247,255,.1)}
        .card-title{font-size:1.2rem;color:var(--primary)}
        .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1.5rem}
        .activity-list{background:rgba(20,20,40,.7);border-radius:10px;padding:1.5rem;border:1px solid rgba(0,247,255,.2)}
        .activity-item{display:flex;padding:1rem 0;border-bottom:1px solid rgba(0,247,255,.1)}
        .activity-item:last-child{border-bottom:none}
        .activity-icon{width:40px;height:40px;border-radius:50%;background:rgba(0,247,255,.1);display:flex;align-items:center;justify-content:center;margin-right:1rem;color:var(--primary)}
        .activity-content{flex:1}
        .activity-title{font-weight:700;margin-bottom:.3rem}
        .activity-desc{font-size:.9rem;color:rgba(255,255,255,.7);margin-bottom:.5rem}
        @media(max-width:768px){.sidebar{transform:translateX(-100%);transition:transform .3s ease}.sidebar.active{transform:translateX(0)}.main-content{margin-left:0}.top-bar{padding:0 1rem}.content-container{padding:1rem}}
        
        /* 通用按钮样式 */
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            text-decoration: none;
            display: inline-block;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            color: white;
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            color: #1f2937;
        }
        
        .btn-success:hover {
            color: #1f2937;
            box-shadow: 0 8px 25px rgba(132, 250, 176, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
        }
        
        .btn-danger:hover {
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #1f2937;
        }
        
        .btn-warning:hover {
            color: #1f2937;
            box-shadow: 0 8px 25px rgba(251, 191, 36, 0.4);
        }
        
        /* 通用表单样式 */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--light);
            font-weight: 600;
            font-size: 14px;
        }
        
        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid rgba(0, 247, 255, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 247, 255, 0.1);
            background: rgba(255, 255, 255, 0.08);
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        /* 通用状态标签 */
        .status-active {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }
        
        .status-inactive {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .status-draft {
            background: rgba(156, 163, 175, 0.2);
            color: #9ca3af;
            border: 1px solid rgba(156, 163, 175, 0.3);
        }
        
        .status-published {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        /* 消息提示系统 */
        .message-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            max-width: 400px;
        }
        
        .message {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 10px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-left: 4px solid;
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateX(450px);
            transition: transform 0.3s ease;
        }
        
        .message.show {
            transform: translateX(0);
        }
        
        .message.success { border-left-color: #22c55e; color: #166534; }
        .message.error { border-left-color: #ef4444; color: #dc2626; }
        .message.info { border-left-color: #3b82f6; color: #1d4ed8; }
        
        .message-icon {
            font-size: 18px;
            font-weight: bold;
        }
        
        /* 加载动画 */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* 空状态 */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: rgba(255, 255, 255, 0.6);
        }
        
        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }
        
        .empty-state-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .empty-state-description {
            font-size: 16px;
            margin-bottom: 24px;
        }
        
        /* 统计卡片 */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }
        
        .stat-card {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 8px;
        }
        
        .stat-label {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* 统一模态框样式 - 深色底白字，确保最佳可读性 */
        .modal {
            background: rgba(0, 0, 0, 0.9) !important;
            backdrop-filter: blur(15px);
        }

        .modal-dialog {
            max-width: 800px;
            margin: 1.75rem auto;
        }

        .modal-content {
            background: linear-gradient(145deg, rgba(25, 25, 45, 0.98), rgba(15, 15, 35, 0.98)) !important;
            backdrop-filter: blur(25px);
            border: 2px solid rgba(0, 247, 255, 0.4);
            border-radius: 20px !important;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.7);
            animation: modalSlideIn 0.3s ease;
            color: #ffffff !important;
            position: relative;
            z-index: 1056;
        }

        .modal-header {
            background: linear-gradient(135deg, rgba(0, 247, 255, 0.2), rgba(255, 0, 170, 0.2));
            border-bottom: 1px solid rgba(0, 247, 255, 0.4);
            border-radius: 20px 20px 0 0;
            padding: 20px 24px;
        }

        .modal-body {
            padding: 24px;
            max-height: 70vh;
            overflow-y: auto;
            background: rgba(20, 20, 40, 0.9);
        }

        .modal-footer {
            background: rgba(25, 25, 45, 0.95);
            border-top: 1px solid rgba(0, 247, 255, 0.4);
            border-radius: 0 0 20px 20px;
            padding: 20px 24px;
        }

        .btn-close {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            width: 32px;
            height: 32px;
            position: relative;
            opacity: 0.8;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-close:hover {
            background: rgba(255, 255, 255, 0.2);
            opacity: 1;
            transform: scale(1.1);
        }

        .btn-close::before,
        .btn-close::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 2px;
            background: #ffffff;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .btn-close::before {
            transform: translate(-50%, -50%) rotate(45deg);
        }

        .btn-close::after {
            transform: translate(-50%, -50%) rotate(-45deg);
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-50px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .modal h3, .modal h5 {
            color: #ffffff;
            font-weight: 600;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(0, 247, 255, 0.3);
        }

        .modal label {
            color: rgba(255, 255, 255, 0.95);
            font-weight: 500;
            margin-bottom: 8px;
        }

        .modal label span {
            color: #ffffff;
            font-weight: 600;
        }

        /* 统一表单样式 - 深色底白字，确保最佳可读性 */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #ffffff !important;
            font-weight: 600;
            font-size: 14px;
            text-shadow: 0 0 5px rgba(0, 247, 255, 0.3);
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid rgba(0, 247, 255, 0.4);
            border-radius: 8px;
            background: rgba(20, 20, 40, 0.95) !important;
            color: #ffffff !important;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.4);
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 247, 255, 0.3), inset 0 2px 4px rgba(0, 0, 0, 0.4);
            background: rgba(25, 25, 45, 0.98) !important;
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* 通用输入框样式 - 覆盖所有input、select、textarea */
        input, select, textarea {
            background: rgba(20, 20, 40, 0.95) !important;
            border: 2px solid rgba(0, 247, 255, 0.4) !important;
            color: #ffffff !important;
            border-radius: 8px;
            padding: 12px 16px;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.4);
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary) !important;
            box-shadow: 0 0 0 3px rgba(0, 247, 255, 0.3), inset 0 2px 4px rgba(0, 0, 0, 0.4) !important;
            background: rgba(25, 25, 45, 0.98) !important;
        }

        input::placeholder, textarea::placeholder {
            color: rgba(255, 255, 255, 0.7) !important;
        }

        /* 下拉选项样式 */
        select option {
            background: rgba(20, 20, 40, 0.98) !important;
            color: #ffffff !important;
            padding: 8px;
        }

        /* 内联样式模态框的统一样式 - 深色底白字 */
        .modal[style*="display:none"] {
            background: rgba(0, 0, 0, 0.9) !important;
            backdrop-filter: blur(15px);
        }

        .modal[style*="display:none"] .modal-content {
            background: linear-gradient(145deg, rgba(25, 25, 45, 0.98), rgba(15, 15, 35, 0.98)) !important;
            border: 2px solid rgba(0, 247, 255, 0.4) !important;
            color: #ffffff !important;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.7) !important;
        }

        .modal[style*="display:none"] h3 {
            color: #ffffff !important;
            text-shadow: 0 0 10px rgba(0, 247, 255, 0.4);
        }

        .modal[style*="display:none"] label span {
            color: #ffffff !important;
        }

        .modal[style*="display:none"] input,
        .modal[style*="display:none"] select,
        .modal[style*="display:none"] textarea {
            background: rgba(20, 20, 40, 0.95) !important;
            border: 2px solid rgba(0, 247, 255, 0.4) !important;
            color: #ffffff !important;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.4) !important;
        }

        .modal[style*="display:none"] input:focus,
        .modal[style*="display:none"] select:focus,
        .modal[style*="display:none"] textarea:focus {
            border-color: var(--primary) !important;
            box-shadow: 0 0 0 3px rgba(0, 247, 255, 0.3), inset 0 2px 4px rgba(0, 0, 0, 0.4) !important;
            background: rgba(25, 25, 45, 0.98) !important;
        }

        /* 强制覆盖所有模态框中的文字颜色 */
        .modal * {
            color: #ffffff !important;
        }

        .modal label {
            color: #ffffff !important;
        }

        .modal span {
            color: #ffffff !important;
        }

        .modal h1, .modal h2, .modal h3, .modal h4, .modal h5, .modal h6 {
            color: #ffffff !important;
        }

        /* 确保所有表单元素都有深色背景 */
        .modal input, .modal select, .modal textarea {
            background: rgba(20, 20, 40, 0.95) !important;
            color: #ffffff !important;
        }

        .modal input:focus, .modal select:focus, .modal textarea:focus {
            background: rgba(25, 25, 45, 0.98) !important;
        }
    </style>
    {% block extra_head %}{% endblock %}
</head>
<body>
    <div class="particles" id="particles-js"></div>
    <div class="sidebar">
        <div class="sidebar-header"><div class="sidebar-logo">ACM<span>LAB</span></div></div>
        <div class="sidebar-nav">
            <a class="nav-item" href="/" title="查看前端展示页面"><span class="nav-icon">👁️</span><span>查看前端</span></a>
            <div style="height: 1px; background: rgba(255,255,255,0.1); margin: 0.5rem 1rem;"></div>

            <a class="nav-item {% if active_nav=='home' %}active{% endif %}" href="/admin/home"><span class="nav-icon">🏠</span><span>主页</span></a>
            <a class="nav-item {% if active_nav=='team' %}active{% endif %}" href="/admin/team"><span class="nav-icon">👥</span><span>团队</span></a>
            <a class="nav-item {% if active_nav=='papers' %}active{% endif %}" href="/admin/papers"><span class="nav-icon">📄</span><span>论文</span></a>
            <a class="nav-item {% if active_nav=='innovation' %}active{% endif %}" href="/admin/innovation"><span class="nav-icon">🏆</span><span>科创</span></a>
            <a class="nav-item {% if active_nav=='activities' %}active{% endif %}" href="/admin/activities"><span class="nav-icon">📢</span><span>动态</span></a>
            <a class="nav-item {% if active_nav=='algorithms' %}active{% endif %}" href="/admin/algorithms"><span class="nav-icon">🤖</span><span>算法</span></a>
        </div>
        <div class="sidebar-footer">
            <div class="user-profile" id="userProfile" data-avatar-url="{{ avatar_url|default('') }}" data-display-name="{{ display_name|default(username) }}">
                <div class="user-avatar" title="点击查看与编辑个人资料">AD</div>
                <div class="user-info">
                    <div class="user-name">{{ username }}</div>
                    <div class="user-role">超级管理员</div>
                </div>
            </div>
        </div>
    </div>
    <div class="main-content">
        <div class="top-bar">
            <div class="page-title">{% block page_title %}管理{% endblock %}</div>
            <div class="top-bar-actions">
                <div class="logout-btn" id="logoutBtn" onclick="if(confirm('确定要退出登录吗？')) window.location.href='/admin/logout'"><span>🚪</span></div>
            </div>
        </div>
        <div class="content-container">
            {% block content %}{% endblock %}
        </div>
    </div>
    <!-- 个人资料模态框 -->
    <div id="profileModal" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.5);z-index:2000">
        <div style="width:min(800px,95vw);max-height:90vh;overflow-y:auto;background:rgba(20,20,40,.95);border:1px solid rgba(0,247,255,.3);border-radius:10px;padding:1.5rem;color:#fff">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:1.5rem">
                <div style="font-family:'Orbitron',sans-serif;color:var(--primary);font-weight:700;font-size:1.3rem">个人资料</div>
                <button id="profileClose" style="background:rgba(0,247,255,.15);border:1px solid rgba(0,247,255,.35);color:#fff;border-radius:50%;width:32px;height:32px;cursor:pointer;font-size:18px">×</button>
            </div>
            
            <!-- 头像上传区域 -->
            <div style="margin-bottom:2rem;padding:1.5rem;background:rgba(255,255,255,.03);border:1px solid rgba(0,247,255,.2);border-radius:8px">
                <div style="color:var(--primary);font-weight:700;margin-bottom:1rem;font-size:1.1rem">头像设置</div>
                <div style="display:flex;gap:1.5rem;align-items:flex-start">
                    <div>
                        <div id="avatarPreview" style="width:120px;height:120px;border-radius:10px;background:rgba(255,255,255,.06);border:2px solid rgba(0,247,255,.25);background-size:cover;background-position:center;display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--primary)">无头像</div>
                    </div>
                    <div style="flex:1">
                        <form id="avatarForm" style="display:flex;flex-direction:column;gap:1rem">
                            <div>
                                <label style="display:block;margin-bottom:0.5rem;color:var(--light);font-weight:600">选择头像文件</label>
                                <input id="avatarInput" name="avatar" type="file" accept="image/*" style="width:100%;padding:0.8rem;border:1px solid rgba(0,247,255,.3);border-radius:6px;background:rgba(255,255,255,.05);color:#fff;font-size:14px" />
                            </div>
                            <button type="submit" style="align-self:flex-start;padding:.8rem 1.5rem;border:none;border-radius:6px;background:var(--primary);color:var(--dark);font-weight:700;cursor:pointer;font-size:14px;transition:all 0.3s ease">📷 上传头像</button>
                        </form>
                        <div style="margin-top:1rem;font-size:0.85rem;color:rgba(255,255,255,0.6)">
                            支持 JPG、PNG 格式，文件大小不超过 5MB
                        </div>
                    </div>
                </div>
            </div>
            
                         <!-- 基本信息和密码修改 -->
             <div style="display:grid;grid-template-columns:1fr 1fr;gap:1.5rem">
                 <div class="card" style="margin:0;padding:1.5rem;border:1px solid rgba(0,247,255,.2);background:rgba(20,20,40,.6)">
                     <div class="card-title" style="margin-bottom:1rem;color:var(--primary);font-size:1.1rem">基本信息</div>
                     <form id="profileForm" style="display:grid;gap:1rem">
                         <div>
                             <label style="display:block;margin-bottom:0.5rem;color:var(--light);font-weight:600">显示名称</label>
                             <input id="displayName" type="text" style="width:100%;padding:.8rem;border-radius:6px;border:1px solid rgba(0,247,255,.3);background:rgba(255,255,255,.05);color:#fff" />
                         </div>
                         <div>
                             <label style="display:block;margin-bottom:0.5rem;color:var(--light);font-weight:600">登录用户名</label>
                             <input id="loginUsername" type="text" style="width:100%;padding:.8rem;border-radius:6px;border:1px solid rgba(0,247,255,.3);background:rgba(255,255,255,.05);color:#fff" />
                         </div>
                         <button type="submit" style="padding:.8rem 1.5rem;border:none;border-radius:6px;background:var(--primary);color:var(--dark);font-weight:700;cursor:pointer;transition:all 0.3s ease">💾 保存资料</button>
                     </form>
                 </div>
                 <div class="card" style="margin:0;padding:1.5rem;border:1px solid rgba(0,247,255,.2);background:rgba(20,20,40,.6)">
                     <div class="card-title" style="margin-bottom:1rem;color:var(--primary);font-size:1.1rem">修改密码</div>
                     <form id="passwordForm" style="display:grid;gap:1rem">
                         <div>
                             <label style="display:block;margin-bottom:0.5rem;color:var(--light);font-weight:600">当前密码</label>
                             <input id="currentPassword" type="password" autocomplete="current-password" style="width:100%;padding:.8rem;border-radius:6px;border:1px solid rgba(0,247,255,.3);background:rgba(255,255,255,.05);color:#fff" />
                         </div>
                         <div>
                             <label style="display:block;margin-bottom:0.5rem;color:var(--light);font-weight:600">新密码</label>
                             <input id="newPassword" type="password" autocomplete="new-password" style="width:100%;padding:.8rem;border-radius:6px;border:1px solid rgba(0,247,255,.3);background:rgba(255,255,255,.05);color:#fff" />
                         </div>
                         <div>
                             <label style="display:block;margin-bottom:0.5rem;color:var(--light);font-weight:600">确认新密码</label>
                             <input id="confirmPassword" type="password" autocomplete="new-password" style="width:100%;padding:.8rem;border-radius:6px;border:1px solid rgba(0,247,255,.3);background:rgba(255,255,255,.05);color:#fff" />
                         </div>
                         <button type="submit" style="padding:.8rem 1.5rem;border:none;border-radius:6px;background:var(--primary);color:var(--dark);font-weight:700;cursor:pointer;transition:all 0.3s ease">🔒 更新密码</button>
                     </form>
                 </div>
             </div>
        </div>
    </div>
    <!-- 修复particles.js加载问题 -->
    <script>
// API URL辅助函数 - 兼容Vercel部署
function getApiUrl(path) {
    // 在Vercel环境下使用当前域名，本地开发使用相对路径
    if (window.location.hostname.includes('vercel.app') || window.location.hostname.includes('vercel.com')) {
        return window.location.origin + path;
    }
    return path;
}
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/particles.js/2.0.0/particles.min.js"></script>
    <script>
        // 安全地初始化particles.js
        if (typeof particlesJS !== 'undefined') {
            particlesJS("particles-js", {"particles":{"number":{"value":40,"density":{"enable":true,"value_area":800}},"color":{"value":"#00f7ff"},"shape":{"type":"circle"},"opacity":{"value":0.3},"size":{"value":3,"random":true},"line_linked":{"enable":true,"distance":150,"color":"#00f7ff","opacity":0.1,"width":1},"move":{"enable":true,"speed":1}},"interactivity":{"detect_on":"canvas","events":{"onhover":{"enable":true,"mode":"grab"},"onclick":{"enable":true,"mode":"push"},"resize":true},"modes":{"grab":{"distance":140,"line_linked":{"opacity":0.2}},"repulse":{"distance":200,"duration":0.4},"push":{"particles_nb":4}}},"retina_detect":true});
        } else {
            console.warn('particles.js 未加载，跳过粒子效果初始化');
        }
        const userProfileEl = document.getElementById('userProfile');
        const userAvatarEl = userProfileEl.querySelector('.user-avatar');
        const profileModal = document.getElementById('profileModal');
        const profileClose = document.getElementById('profileClose');
        const avatarPreview = document.getElementById('avatarPreview');
        const avatarForm = document.getElementById('avatarForm');
        const avatarInput = document.getElementById('avatarInput');
        const profileForm = document.getElementById('profileForm');
        const displayNameInput = document.getElementById('displayName');
        const loginUsernameInput = document.getElementById('loginUsername');
        const passwordForm = document.getElementById('passwordForm');
        const currentPasswordInput = document.getElementById('currentPassword');
        const newPasswordInput = document.getElementById('newPassword');
        const confirmPasswordInput = document.getElementById('confirmPassword');

        function openProfile(){ profileModal.style.display='flex'; }
        function closeProfile(){ profileModal.style.display='none'; }

        function initUserAvatar(){
            console.log('🔧 初始化用户头像...');
            console.log('🔍 userProfileEl:', userProfileEl);
            console.log('🔍 userAvatarEl:', userAvatarEl);
            
            const url = userProfileEl.getAttribute('data-avatar-url') || '';
            console.log('🖼️ 初始头像URL:', url);
            
            if(url){
                // 添加时间戳避免缓存问题
                const avatarUrlWithTimestamp = `${url}?t=${Date.now()}`;
                console.log('🕰️ 带时间戳的URL:', avatarUrlWithTimestamp);
                
                userAvatarEl.style.backgroundImage = `url('${avatarUrlWithTimestamp}')`;
                userAvatarEl.style.backgroundSize = 'cover';
                userAvatarEl.style.backgroundPosition = 'center';
                userAvatarEl.textContent = '';
                
                console.log('✅ 初始头像已设置');
                console.log('🎨 当前样式:', window.getComputedStyle(userAvatarEl).backgroundImage);
            } else {
                console.log('⚠️ 没有初始头像URL');
            }
        }

        async function loadProfile(){
            try{
                const res = await fetch(getApiUrl('/api/admin/profile'));
                if(!res.ok) return;
                const data = await res.json();
                displayNameInput.value = data.display_name || '';
                loginUsernameInput.value = data.username || '';
                if(data.avatar_url){
                    // 添加时间戳避免缓存问题
                    const avatarUrlWithTimestamp = `${data.avatar_url}?t=${Date.now()}`;
                    
                    // 更新预览区域
                    avatarPreview.style.backgroundImage = `url('${avatarUrlWithTimestamp}')`;
                    avatarPreview.style.backgroundSize = 'cover';
                    avatarPreview.style.backgroundPosition = 'center';
                    avatarPreview.textContent = '';
                    
                    // 更新侧边栏头像
                    userAvatarEl.style.backgroundImage = `url('${avatarUrlWithTimestamp}')`;
                    userAvatarEl.style.backgroundSize = 'cover';
                    userAvatarEl.style.backgroundPosition = 'center';
                    userAvatarEl.textContent = '';
                    
                    // 更新 data-avatar-url 属性
                    userProfileEl.setAttribute('data-avatar-url', data.avatar_url);
                }
            }catch(e){ console.error(e); }
        }

        userProfileEl.addEventListener('click', openProfile);
        profileClose.addEventListener('click', closeProfile);
        profileModal.addEventListener('click', (e)=>{ if(e.target===profileModal) closeProfile(); });

        avatarForm.addEventListener('submit', async (e)=>{
            e.preventDefault();
            console.log('🚀 开始头像上传...');
            
            if(!avatarInput.files || !avatarInput.files[0]){ alert('请选择图片'); return; }
            
            console.log('📁 文件选择:', avatarInput.files[0].name);
            
            const fd = new FormData();
            fd.append('avatar', avatarInput.files[0]);
            
            try {
                const res = await fetch(getApiUrl('/api/admin/avatar'), { method: 'POST', body: fd });
                console.log('📡 上传响应状态:', res.status);
                
                const data = await res.json().catch(()=>({}));
                console.log('📦 响应数据:', data);
                
                if(!res.ok){ 
                    console.error('❌ 上传失败:', data.error);
                    alert(data.error||'上传失败'); 
                    return; 
                }
                
                if(data.avatar_url){
                    // 添加时间戳避免缓存问题
                    const avatarUrlWithTimestamp = `${data.avatar_url}?t=${Date.now()}`;
                    console.log('🖼️ 新头像URL:', avatarUrlWithTimestamp);
                    
                    // 检查元素是否存在
                    console.log('🔍 检查元素:');
                    console.log('  - userAvatarEl:', userAvatarEl);
                    console.log('  - avatarPreview:', avatarPreview);
                    console.log('  - userProfileEl:', userProfileEl);
                    
                    // 更新预览区域
                    if(avatarPreview) {
                        avatarPreview.style.backgroundImage = `url('${avatarUrlWithTimestamp}')`;
                        avatarPreview.style.backgroundSize = 'cover';
                        avatarPreview.style.backgroundPosition = 'center';
                        avatarPreview.textContent = '';
                        console.log('✅ 预览区域已更新');
                    }
                    
                    // 更新侧边栏头像
                    if(userAvatarEl) {
                        console.log('🔄 更新侧边栏头像...');
                        userAvatarEl.style.backgroundImage = `url('${avatarUrlWithTimestamp}')`;
                        userAvatarEl.style.backgroundSize = 'cover';
                        userAvatarEl.style.backgroundPosition = 'center';
                        userAvatarEl.textContent = '';
                        
                        // 强制重绘
                        userAvatarEl.style.display = 'none';
                        userAvatarEl.offsetHeight; // 触发重排
                        userAvatarEl.style.display = '';
                        
                        console.log('✅ 侧边栏头像已更新');
                        console.log('🎨 当前样式:', window.getComputedStyle(userAvatarEl).backgroundImage);
                    } else {
                        console.error('❌ 找不到 userAvatarEl 元素');
                    }
                    
                    // 更新 data-avatar-url 属性，确保下次页面刷新时能正确显示
                    if(userProfileEl) {
                        userProfileEl.setAttribute('data-avatar-url', data.avatar_url);
                        console.log('✅ data-avatar-url 已更新');
                    }
                    
                    alert('头像已更新');
                    console.log('🎉 头像上传完成!');
                } else {
                    console.error('❌ 响应中没有 avatar_url');
                }
            } catch(error) {
                console.error('❌ 上传过程中发生错误:', error);
                alert('上传失败: ' + error.message);
            }
        });

        profileForm.addEventListener('submit', async (e)=>{
            e.preventDefault();
            const payload = { display_name: displayNameInput.value.trim(), username: loginUsernameInput.value.trim() };
            const res = await fetch(getApiUrl('/api/admin/profile'), { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            const data = await res.json().catch(()=>({}));
            if(!res.ok){ alert(data.error||'保存失败'); return; }
            alert('资料已保存');
            if(payload.username){ window.location.reload(); }
        });

        passwordForm.addEventListener('submit', async (e)=>{
            e.preventDefault();
            const current_password = currentPasswordInput.value;
            const new_password = newPasswordInput.value;
            const confirm_password = confirmPasswordInput.value;
            if(!current_password || !new_password){ alert('请输入完整'); return; }
            if(new_password !== confirm_password){ alert('两次新密码不一致'); return; }
            const res = await fetch(getApiUrl('/api/admin/password'), { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ current_password, new_password }) });
            const data = await res.json().catch(()=>({}));
            if(!res.ok){ alert(data.error||'更新失败'); return; }
            alert('密码已更新');
            currentPasswordInput.value = newPasswordInput.value = confirmPasswordInput.value = '';
        });

        initUserAvatar();
        loadProfile();
    </script>
    
    <!-- Bootstrap JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    
    <!-- Socket.IO for real-time updates -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    <script src="/static/socket-client.js"></script>
    
    {% block extra_scripts %}{% endblock %}
</body>
</html> 